# Weather Station System Configuration

system:
  name: "Weather Station Local Server"
  location: "Your Location"
  timezone: "Asia/Jakarta"

database:
  path: "./data/weatherstation.db"
  backup_enabled: true
  backup_interval: 86400  # 24 hours in seconds
  auto_cleanup_enabled: true  # Safety net: cleanup orphaned uploaded records
  auto_cleanup_days: 1  # Delete uploaded data older than 1 day (safety net only)

mqtt:
  # Protocol: tcp, ws (WebSocket), or wss (WebSocket Secure)
  protocol: "wss"

  # EMQX Broker (Prasena Energy - Staging)
  broker_url: "wss://emqx-staging.prasenaenergy.com/mqtt"
  broker_host: "emqx-staging.prasenaenergy.com"
  broker_port: 443  # WSS uses port 443

  # Authentication
  username: "prasena"
  password: "emqxoversecurewebsocket"

  # Connection settings
  qos: 1
  clean_session: true
  keepalive: 60
  reconnect_delay: 5  # seconds

  # Topics
  topics:
    # Publish topics (outbound data)
    sensor_data: "prasena/sensors"
    weather_data: "prasena/sensors/weather"
    battery_data: "prasena/sensors/battery"
    system_status: "prasena/system/status"

    # Subscribe topics (inbound commands - future use)
    control: "prasena/control/#"

battery_sensors:
  enabled: true
  poll_interval: 10  # Poll battery sensors every 10 seconds
  sampling_rate: 1   # Sample every 1 second
  aggregation_window: 300  # Aggregate every 5 minutes (300 seconds)

weather_station:
  enabled: true
  http_port: 5001  # HTTP receiver port
  endpoint: "/data"  # POST endpoint for weather data

  # Dynamic field mapping: internal_name -> external_field_name
  # Weather station sends data with external names, gateway maps to internal
  field_mapping:
    temperature: "temp"      # Internal: temperature, External: temp
    humidity: "hum"          # Internal: humidity, External: hum
    pressure: "press"        # Internal: pressure, External: press
    wind_speed: "wind"       # Internal: wind_speed, External: wind
    rainfall: "rain"         # Internal: rainfall, External: rain
    # Add more mappings as needed when documentation arrives

  # Validation rules
  validation:
    required_fields: ["temp"]  # At minimum require temperature
    value_ranges:
      temp: [-40, 80]          # Temperature range in Celsius
      hum: [0, 100]            # Humidity percentage
      press: [800, 1200]       # Pressure in hPa
      wind: [0, 200]           # Wind speed in km/h
      rain: [0, 500]           # Rainfall in mm

upload:
  enabled: true
  interval: 60  # Upload interval in seconds (1-5 minutes = 60-300)
  batch_size: 100  # Number of records per batch
  max_retry: 5  # Maximum retry attempts
  retry_interval: 30  # Retry interval in seconds
  main_server_url: "http://your-main-server.com/api/data"
  api_key: "your_api_key_here"  # CHANGE THIS!
  timeout: 30  # Request timeout in seconds

api:
  enabled: true
  host: "0.0.0.0"
  port: 5000
  debug: false
  cors_enabled: true
  cors_origins: ["*"]

logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_to_file: true
  log_file: "./logs/system.log"
  weather_log_file: "./logs/weather_receiver.log"
  mqtt_log_file: "./logs/mqtt_publisher.log"
  max_file_size: 10485760  # 10MB
  backup_count: 5

# Device auto-discovery (optional)
discovery:
  enabled: false  # Set to true to enable auto-discovery
  scan_interval: 3600  # Scan every hour
  pzem_address_range: [1, 20]  # Scan addresses 1-20
